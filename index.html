<!DOCTYPE html>
<html>

<head>
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
</head>

<body>
  <h1 align="center">Roadtrip</h1>
  <div id="graph" align="center"></div>

  <script>
    console.log(d3); // test if d3 is loaded

    const width = 800;
    const height = 400;

    const svg = d3.select("#graph")
      .append("svg")
      .attr("width", width)
      .attr("height", height);

    // --- Sky ---
    const sky = svg.append('rect')
      .attr('x', 0)
      .attr('y', 0)
      .attr('width', width)
      .attr('height', height)
      .attr('fill', 'skyblue');

    function animateSky() {
      // reset animation
      sky.interrupt().attr('fill', 'skyblue'); // STart at light bue daytime sky

      sky
        .transition()
        .duration(22000) // Progress to dark blue as sun and moon go through
        .ease(d3.easeCubicInOut)
        .attr("fill", "#2D3C59") // Dark nighttime sky
        .on("end", animateSky); // loop
    }

    animateSky();


    // --- Mountain ---
    const mountainPoints = [
      [0, 250],
      [150, 100],
      [300, 250],
      [450, 120],
      [600, 250],
      [width, 150],
      [width, height],
      [0, height]
    ];

    svg.append('polygon')
      .attr('points', mountainPoints.map(d => d.join(",")).join(" "))
      .attr('fill', 'darkgrey')
      .attr('stroke', 'black');

    // --- Road ---
    svg.append('rect')
      .attr('x', 0)
      .attr('y', 280)
      .attr('width', 800)
      .attr('height', 120)
      .attr('fill', 'grey')
      .attr('stroke', 'black');

    svg.append('line')
      .attr('x1', 0)
      .attr('y1', 340)
      .attr('x2', 800)
      .attr('y2', 340)
      .attr('stroke', 'yellow')
      .attr('stroke-width', 5)
      .style("stroke-dasharray", "20,20");

    // --- Sun ---
    const sun = svg.append("circle")
      .attr('cx', 50)
      .attr('cy', 50)
      .attr('r', 20)
      .attr('fill', 'yellow')
      .attr('stroke', 'black');

    function animateSun() {
      // reset animation
      sun.interrupt().attr("cx", -50); // Start sun out of pciture

      sun
        .transition()
        .duration(2000)
        .ease(d3.easeCubicInOut)
        .attr("cx", 50) // Bring sun in picture
        .transition()
        .duration(2000)
        .ease(d3.easeCubicInOut)
        .attr("cx", 250)
        .transition()
        .duration(2000)
        .ease(d3.easeCubicInOut)
        .attr("cx", 450)
        .transition()
        .duration(2000)
        .ease(d3.easeCubicInOut)
        .attr("cx", 650)
        .transition()
        .duration(2000)
        .ease(d3.easeCubicInOut)
        .attr("cx", 850) // Hide sun
        .transition()
        .duration(12000) // Hide sun while moon out
        .ease(d3.easeCubicInOut)
        .attr("cx", 850)
        .on("end", animateSun); // loop
    }

    animateSun();

    // --- moon ---
    const moon = svg.append("circle")
      .attr('cx', -150)
      .attr('cy', 50)
      .attr('r', 20)
      .attr('fill', 'grey')
      .attr('stroke', 'black');

    function animateMoon() {
      // reset animation
      moon.interrupt().attr("cx", -50); // Start moon out of picture

      moon
        .transition() // start animation
        .duration(12000) // wait until sun is gone
        .ease(d3.easeCubicInOut) 
        .attr("cx", -50) // Starting location (hiding while sun is out)
        .transition() 
        .duration(2000)
        .ease(d3.easeCubicInOut)
        .attr("cx", 50) // bring moon on screen
        .transition() 
        .duration(2000)
        .ease(d3.easeCubicInOut)
        .attr("cx", 250)
        .transition()
        .duration(2000)
        .ease(d3.easeCubicInOut)
        .attr("cx", 450)
        .transition() 
        .duration(2000)
        .ease(d3.easeCubicInOut)
        .attr("cx", 650)
        .transition() 
        .duration(2000)
        .ease(d3.easeCubicInOut)
        .attr("cx", 850) // re hide moon
        .on("end", animateMoon); // loop animation
    }

    animateMoon();

    // --- Car Body ---
    svg.append('rect')
      .attr('x', 250)
      .attr('y', 250)
      .attr('width', 200)
      .attr('height', 50)
      .attr('fill', 'red')
      .attr('stroke', 'black');

    svg.append('rect')
      .attr('x', 300)
      .attr('y', 220)
      .attr('width', 100)
      .attr('height', 40)
      .attr('fill', 'darkred')
      .attr('stroke', 'black');

    // --- Wheels ---
    svg.append('circle')
      .attr('cx', 280)
      .attr('cy', 310)
      .attr('r', 20)
      .attr('fill', 'black');

    svg.append('circle')
      .attr('cx', 420)
      .attr('cy', 310)
      .attr('r', 20)
      .attr('fill', 'black');

    // --- Car Stripe ---
    svg.append('path')
      .attr('d', 'M 250 275 L 450 275')
      .attr('fill', 'none')
      .attr('stroke', 'orange')
      .attr('stroke-width', 15);


    // --- Car Headlight ---

    const headlightPoints = [
      [450, 270],
      [450, 280],
      [550, 300],
      [550, 250]
    ];


    const headlight = svg.append('polygon')
      .attr('points', headlightPoints.map(d => d.join(",")).join(" "))
      .attr('fill', 'yellow')
      .attr('opacity', 0);

    function animateHeadlight() {
      // reset animation
      headlight.interrupt().attr('opacity', 0); // Start no opacity (hidden)

      headlight
        .transition()
        .duration(22000) // Slowly turn headlight to greater opacity as day progresses to night
        .ease(d3.easeCubicInOut)
        .attr('opacity', 1) // Full headlight opacity when night
        .on("end", animateHeadlight); // loop
    }

    animateHeadlight();

  </script>




</body>

</html>
